<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Event List</title>
    <link rel="stylesheet" href="../css/style.css" />
    <style>
        .event-card {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .event-card button {
            background-color: green;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        #formPreview {
            background: #fafafa;
            border-radius: 8px;
            padding: 2em;
            margin-top: 2em;
            max-width: 700px;
        }

        #formPreview h2,
        #formPreview h3 {
            margin-top: 0;
        }

        .form-field {
            margin-bottom: 1.5em;
        }

        .form-field label {
            display: block;
            margin-bottom: 0.5em;
            font-weight: 500;
        }

        .form-field input[type="text"],
        .form-field input[type="email"],
        .form-field select {
            width: 320px;
            padding: 8px;
            margin-bottom: 0.5em;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .form-field .radio-group label {
            display: block;
            margin-left: 1.5em;
            margin-bottom: 0.3em;
            font-weight: 400;
        }
    </style>
</head>

<body>
    <nav>
        <div class="head">
            <a href="../html/user.html"><img src="../image/profile-removebg-preview.png" alt="Profile"></a>
            <p>Name</p>
        </div>
        <ul class="ul1">
<<<<<<< HEAD
            <a class="home" href="#" style="font-weight: bold; text-decoration-line: underline;">
                <li>Home</li>
            </a>
            <a href="#">
                <li>Setting</li>
            </a>
            <a href="#">
                <li>Sign Out</li>
            </a>
=======
            <a class="home" href="#"><li>Home</li></a>
            <a href="#"><li>Setting</li></a>
            <a href="#"><li>Sign Out</li></a>
>>>>>>> 6fd61af1bd0a640d4eede107ed7c7ecf6e6cc13a
        </ul>
    </nav>

    <div class="container">
        <h1>Welcome, Admin Dashboard</h1><hr class="hr">
    </div>

    <ul class="ul2">
        <a class="create-event" href="home-page.html"><li>Create Event</li></a>
        <a href="#" style="font-weight: bold; color: black; text-decoration: none;"><li>Event</li></a>
        <a href="#"><li>Response Management</li></a>
        <a href="#"><li>User & Aceess Control</li></a>
    </ul><hr class="hr">

    <h2>Upcoming Events</h2>
    <div id="upcomingEvents"></div>
    <h2>Processing Events</h2>
    <div id="processingEvents"></div>
    <h2>Past Events</h2>
    <div id="pastEvents"></div>
    <div id="formPreview"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getFirestore, collection, getDocs, getDoc, doc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBAYWnichIFDWP4EOv3RyZFNqzyUtROCeI",
            authDomain: "rsvp-website-7541d.firebaseapp.com",
            projectId: "rsvp-website-7541d",
            storageBucket: "rsvp-website-7541d.appspot.com",
            messagingSenderId: "519298669065",
            appId: "1:519298669065:web:1e43e4c598af256c2636d8",
            measurementId: "G-MWMKYXF18R"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const upcomingEvents = document.getElementById('upcomingEvents');
        const processingEvents = document.getElementById('processingEvents');
        const pastEvents = document.getElementById('pastEvents');
        const formPreview = document.getElementById('formPreview');

        function getEventStatus(startDateStr, endDateStr) {
            const today = new Date();
            today.setHours(0,0,0,0);
            const startDate = new Date(startDateStr);
            startDate.setHours(0,0,0,0);
            const endDate = new Date(endDateStr);
            endDate.setHours(0,0,0,0);

            if (today < startDate) {
                return 'upcoming';
            } else if (today >= startDate && today <= endDate) {
                return 'processing';
            } else {
                return 'past';
            }
        }

        async function fetchEvents() {
            const querySnapshot = await getDocs(collection(db, "events"));
            upcomingEvents.innerHTML = '';
            processingEvents.innerHTML = '';
            pastEvents.innerHTML = '';

            querySnapshot.forEach(docSnap => {
                const data = docSnap.data();
                const div = document.createElement('div');
                div.className = 'event-card';
                div.innerHTML = `
                    <h3>${data.name}</h3>
                    <p>Start Date: ${data.startDate}</p>
                    <p>End Date: ${data.endDate}</p>
                    <a href="detail.html?id=${docSnap.id}">
                        <button>View Detail</button>
                    </a>
                `;
                const status = getEventStatus(data.startDate, data.endDate);
                if (status === 'upcoming') {
                    upcomingEvents.appendChild(div);
                } else if (status === 'processing') {
                    processingEvents.appendChild(div);
                } else {
                    pastEvents.appendChild(div);
                }
            });
        }

        // Helper: Render field options as array
        function getOptionsArray(options) {
            if (Array.isArray(options)) return options;
            if (typeof options === "string") return options.split(',').map(opt => opt.trim()).filter(Boolean);
            return [];
        }

        window.viewDetail = async function (id) {
            const docRef = doc(db, "events", id);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const event = docSnap.data();
                formPreview.innerHTML = `
                    <h2>${event.name}</h2>
                    <hr>
                `;

                event.fields.forEach(field => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'form-field';

                    // Label
                    const label = document.createElement('label');
                    label.textContent = field.label;
                    wrapper.appendChild(label);

                    // Field types
                    if (field.type === 'text' || field.type === 'email') {
                        const input = document.createElement('input');
                        input.type = field.type;
                        input.placeholder = `Enter your ${field.label}`;
                        wrapper.appendChild(input);
                    } else if (field.type === 'dropdown') {
                        const select = document.createElement('select');
                        const placeholderOption = document.createElement('option');
                        placeholderOption.textContent = "Please select";
                        placeholderOption.disabled = true;
                        placeholderOption.selected = true;
                        select.appendChild(placeholderOption);
                        getOptionsArray(field.options).forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt;
                            option.textContent = opt;
                            select.appendChild(option);
                        });
                        wrapper.appendChild(select);
                    } else if (field.type === 'radio') {
                        const radioGroup = document.createElement('div');
                        radioGroup.className = 'radio-group';
                        getOptionsArray(field.options).forEach(opt => {
                            const radioLabel = document.createElement('label');
                            const radio = document.createElement('input');
                            radio.type = "radio";
                            radio.name = field.label;
                            radio.value = opt;
                            radioLabel.appendChild(radio);
                            radioLabel.appendChild(document.createTextNode(" " + opt));
                            radioGroup.appendChild(radioLabel);
                        });
                        wrapper.appendChild(radioGroup);
                    }

                    formPreview.appendChild(wrapper);
                });
            }
        }

        fetchEvents();
    </script>
</body>
</html>